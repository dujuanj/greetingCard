<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/common.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
 <style>
       .container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: opacity 0.5s ease; /* 添加平滑的过渡效果 */
        }
        #downloadImage {
            display: none; /* 初始隐藏图片 */
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
     <div class="container result_wrap" id="captureArea">
        <div class="card_wrap">
          
            <p id="nameDisplay"></p>
            <span id="yearDisplay"></span>
            <span id="monthDisplay"></span>
            <span id="dayDisplay"></span>
            <p id="daysDisplay"></p>
            <p id="dateDisplay"></p>
        </div>
    </div>
     <img id="downloadImage" alt="点击生成的图片" />
    <script>
        // 页面加载时，设置 sessionStorage 的值
        document.addEventListener("DOMContentLoaded", function() {
             const captureArea = document.getElementById('captureArea');
            const imgElement = document.getElementById('downloadImage');
            // 从 sessionStorage 中获取并显示值
            const storedName = sessionStorage.getItem('name');
            const storedDate = sessionStorage.getItem('date');

            // 显示获取的值到页面上
            document.getElementById("nameDisplay").textContent = storedName;
           // 将存储的日期字符串（如 2024-09-19）分成年、月、日
            const dateParts = storedDate.split('-'); // 分割日期为 ["2024", "09", "19"]

            const year = dateParts[0];
            const month = dateParts[1];
            const day = dateParts[2];

            // 显示年、月、日到对应的 HTML 元素
            document.getElementById("yearDisplay").textContent = year;
            document.getElementById("monthDisplay").textContent = month;
            document.getElementById("dayDisplay").textContent = day;

             // 计算存储的日期与当前日期的差值
            const selectedDate = new Date(storedDate);
            const currentDate = new Date();

            // 计算两者的时间差 (毫秒)
            const timeDifference = currentDate - selectedDate;

            // 将时间差转为天数
            const daysDifference = Math.floor(timeDifference / (1000 * 60 * 60 * 24));

            // 显示天数
            document.getElementById("daysDisplay").textContent = `${daysDifference}`;
            
          
            captureArea.addEventListener('touchstart', handleLongPress);
        });
        let timeout;

        // 处理长按事件
        function handleLongPress(e) {
            e.preventDefault();
            timeout = setTimeout(() => {
                // 长按超过800ms后，生成图片并自动保存
                saveAsImage();
            }, 800);  // 800毫秒长按
        }

         // 清除长按事件
        document.addEventListener('touchend', function() {
            clearTimeout(timeout);
        });
        document.addEventListener('mouseup', function() {
            clearTimeout(timeout);
        });

        // 使用 html2canvas 将页面内容转换为图片
       // 使用 html2canvas 将页面内容生成图片并自动保存
        function saveAsImage() {
            const captureArea = document.getElementById('captureArea');

            html2canvas(captureArea).then(function(canvas) {
                // 将生成的 canvas 转换为图片的 Data URL
                const imgData = canvas.toDataURL('image/png');

                // 创建一个临时的 a 标签，用于下载
                const link = document.createElement('a');
                link.href = imgData;
                link.download = 'screenshot.png';  // 图片文件名
                document.body.appendChild(link);
                link.click();  // 模拟点击以触发下载
                document.body.removeChild(link);  // 移除临时创建的 a 标签
            });
        }
    </script>
</body>
</html>

